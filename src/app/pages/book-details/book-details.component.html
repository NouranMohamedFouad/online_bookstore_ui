<div class="book-details-container container-fluid">
  <div class="book-list row g-4 m-auto d-flex align-items-center justify-content-center">
    <!-- Loading state -->
    <div *ngIf="isLoading" class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading book details...</p>
    </div>

    <!-- Book details -->
    <div *ngIf="!isLoading && book" class="book-card col-12 col-md-6 position-relative">
      <div class="label">Most Popular</div>
      <div *ngIf="book.stock > 0" class="in-stock-label position-absolute">In Stock</div>
      <h2 class="book-title">{{ book.title }}</h2>
      <img class="book-image img-fluid rounded-circle" [src]="book.image" alt="{{ book.title }}" />
      <div class="book-price">
        <span class="amount">${{ book.price }}</span>
      </div>
      <ul class="book-details-list list-unstyled">
        <li><strong>Author:</strong> {{ book.author }}</li>
        <li><strong>Category:</strong> {{ book.category }}</li>
        <li><strong>Stock:</strong> {{ book.stock }}</li>
        <li><strong>Description:</strong> {{ book.description }}</li>
        <li><strong>Average Rating:</strong> {{ book.average_rating }}</li>
      </ul>
      <div class="d-flex justify-content-end gap-3">
        <button class="book-action-button btn btn-primary px-4 py-2 shadow-sm rounded-pill"
          (click)="navigateToReviews(book.bookId)">Add Review</button>
        
        <!-- Add to Cart Button -->
        <button 
          class="book-action-button btn btn-success px-4 py-2 shadow-sm rounded-pill"
          (click)="addToCart(book._id)"
          [disabled]="!canAddToCart(book)">
          
          <!-- Normal state -->
          <span *ngIf="!isBookBeingAdded(book._id)">
            <i class="bi bi-cart-plus me-1"></i>
            Add to Cart
          </span>
          
          <!-- Loading state -->
          <span *ngIf="isBookBeingAdded(book._id)">
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Adding...
          </span>
        </button>
        
        <!-- Out of stock message -->
        <div *ngIf="book.stock <= 0" class="text-danger mt-2">
          <small>Out of stock</small>
        </div>
      </div>
    </div>

    <!-- Error message -->
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <!-- No book found -->
    <div *ngIf="!isLoading && !book" class="text-center">
      <p class="text-danger">No book details found.</p>
    </div>
  </div>
</div>